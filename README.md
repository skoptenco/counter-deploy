# Задания по онлайн курсу

---

1. Содержимое докеровского локального регистра после публикации в нем образа

![image](/report/registry-1.png)

2. Попытка спуливания образа с локального регистра без авторизации

![image](/report/registry-2.png)

Успешная авторизация и спуливание образа с использованием htpasswd логина и пароля

![image](/report/registry-3.png)
![image](/report/registry-4.png)

3. Сервис на docker swarm с тремя нодами, один из которых переведен в состояние drain

![image](/report/registry-5.png)

Для перевода ноды из состояние drain в active необходимо воспользоваться командой

```
docker node update --availability active <NODE-ID>
```

Однако этого недостаточно, чтобы сервис на этой ноде запустился снова. Его так же необходимо принудительно запустить. Для этого на выбранной ноде необходимо запустить следующую команду:

```
docker service update --force <SERVICE_NAME>
```

4. Конфигурация количества нод, выполняется в docker-stack.yml в секции deploy.replicas

![image](/report/registry-6.png)

Проверка жизнеспособности сервиса выполняется в docker-compose.yml в секцрр healthcheck. В примере у сервиса vote проверка осуществляется следующим образом:

Выполняется обращение на локалхост по 80 порту раз в 15 секунд

![image](/report/registry-7.png)

# Влияние репликации на обработку запросов

---

При выполнении работы было проведено первоначальное нагрузочное тестирование без использования репликации со следующей конфигурацией:

- --users 500
- --spawn-rate 20
- --run-time 30m

По результатам тестирования среднее значение RPS находилось в районе 259 запросов. Значения перцентилей находились на отметке 36 и 70 с периодическими скачками до 43 и 78. Запросов, вернувших ошибку не было

### Docker swarm

При использовании докер сварма среднее значение RPS увеличилось до 293 запросов, однако наблюдались периодические точечные скачки до 243. Значения перцентилей опустились до отметок 33 и 65, но при этом были чуть менее стабильны, имелись так же резкие скачки значений 95 перцентиля вверх до 81

По результатам тестирования была замечена одна особенность при использовании репликации. При использовании реплицированных сервисов использовался единственный сервис redis, благодаря чему периодически возникал повышенный наплыв запросов, что приводило к скачкам на графиках

### k3s

При использовании k3s среднее значение оказалось чуть ниже в сравнении с docker swarm, а именно 288. Значения перцентилей оказались немного выше, 34 и 67, но при этом оказались сильно стабильнее, наблюдался всего один скачок до 39 и 78.  

Конфигурация k3s

![image](/report/k3s.png)